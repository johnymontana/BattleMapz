barChart=function(){function q(h){function l(a){var d=[],e=-1,f=a.length,g;while(++e<f)g=a[e],d.push("M",b(g.key),",",k,"V",c(g.value),"h4.5V",k);return d.join("")}function q(a){var b=+(a=="e"),c=b?1:-1,d=k/3;return"M"+.5*c+","+d+"A6,6 0 0 "+b+" "+6.5*c+","+(d+6)+"V"+(2*d-6)+"A6,6 0 0 "+b+" "+.5*c+","+2*d+"Z"+"M"+2.5*c+","+(d+8)+"V"+(2*d-8)+"M"+4.5*c+","+(d+8)+"V"+(2*d-8)}var j=b.range()[1],k=c.range()[0];c.domain([i.top(1)[0].value/100,i.top(1)[0].value]),h.each(function(){var c=d3.select(this),h=c.select("g");if(h.empty()){var r=c.append("svg").attr("width",j+a.left+a.right).attr("height",k+a.top+a.bottom).attr("id",n);if(p){fill_svg=r.append("defs").append("linearGradient").attr("id","lg-"+d).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%");var s=b.copy().domain([0,20]).range(b.range);for(var t=0;t<20;t++)fill_svg.append("stop").attr("stop-color",p(t)).attr("offset",t*5+"%").attr("stop-opacity","1")}h=r.append("g").attr("transform","translate("+a.left+","+a.top+")"),m&&o.text(e.tickFormat()(m[0])+" - "+e.tickFormat()(m[1])),h.append("clipPath").attr("id","clip-"+d).append("rect").attr("width",j).attr("height",k),h.selectAll(".bar").data(["background","foreground"]).enter().append("path").attr("class",function(a){return a+" bar"}).datum(i.all()),h.selectAll(".foreground.bar").attr("clip-path","url(#clip-"+d+")").attr("fill","url(#lg-"+d+")"),h.append("g").attr("class","axis").attr("transform","translate(0,"+k+")").call(e);var u=h.append("g").attr("class","brush").call(f);u.selectAll("rect").attr("height",k),u.selectAll(".resize").append("path").attr("d",q)}if(g){g=!1,h.selectAll(".brush").call(f),c.select(".title a").style("display",f.empty()?"none":null);if(f.empty())h.selectAll("#clip-"+d+" rect").attr("x",0).attr("width",j);else{var v=f.extent();h.selectAll("#clip-"+d+" rect").attr("x",b(v[0])).attr("width",b(v[1])-b(v[0]))}}h.selectAll(".bar").attr("d",l)})}barChart.id||(barChart.id=0);var a={top:5,right:10,bottom:20,left:10},b,c=d3.scale.pow().exponent(.01).clamp(!0).range([20,0]),d=barChart.id++,e=d3.svg.axis().orient("bottom"),f=d3.svg.brush(),g,h,i,j,k,l,m=null,n,o,p;return f.on("brushstart.chart",function(){var a=d3.select(this.parentNode.parentNode.parentNode)}),f.on("brush.chart",function(){var a=d3.select(this.parentNode),c=f.extent();j&&a.select(".brush").call(f.extent(c=c.map(j))).selectAll(".resize").style("display",null),a.select("#clip-"+d+" rect").attr("x",b(c[0])).attr("width",b(c[1])-b(c[0])),h.filterRange(c),m=c,c[1]-c[0]>0?o&&o.text(e.tickFormat()(c[0])+" - "+e.tickFormat()(c[1])):o&&o.text("")}),f.on("brushend.chart",function(){if(f.empty()){var a=d3.select(this.parentNode.parentNode.parentNode);a.select("#clip-"+d+" rect").attr("x",null).attr("width","100%"),h.filterAll(),m=null}}),q.margin=function(b){return arguments.length?(a=b,q):a},q.x=function(a){return arguments.length?(b=a,e.scale(b),f.x(b),q):b},q.tickFormat=function(a){return arguments.length?(k=a,e.tickFormat(k),q):k},q.name_id=function(a){return arguments.length?(n=a,q):n},q.ticks=function(a){return arguments.length?(ticks=a,a.length?e.tickValues(ticks):e.ticks(ticks),q):l},q.fill=function(a){return arguments.length?(p=a,q):p},q.y=function(a){return arguments.length?(c=a,q):c},q.dimension=function(a){return arguments.length?(h=a,q):h},q.filter=function(a){return arguments.length?(a?(m=a,f.extent(a),h.filterRange(a),o&&o.text(e.tickFormat()(m[0])+" - "+e.tickFormat()(m[1]))):(f.clear(),m=null,h.filterAll()),g=!0,q):m},q.group=function(a){return arguments.length?(i=a,q):i},q.round=function(a){return arguments.length?(j=a,q):j},d3.rebind(q,f,"on")};var crosslet;crosslet={},_||console.log("Please include underscore.js"),crosslet.createConfig=function(a,b){var c;return c=jQuery.extend(!0,jQuery.extend(!0,{},a),b)},crosslet.id=function(a){return a},crosslet.idf=function(a){return crosslet.id},crosslet.notimplemented=function(){throw"This function is not set. Please check your config."},crosslet.changeSelect=function(a,b){return $(a).find("option").filter(function(){return $(this).val()===b}).attr("selected",!0)},crosslet.defaultConfig={map:{leaflet:{key:"--your key--",styleId:64657,attribution:'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>'},view:{center:[51.505,-0.09],zoom:11},geo:{url:"please specify correct location of your geojson",name_field:"name",id_field:"code",topo_object:"please specify correct object name"}}},{data:{version:"1.0",id_field:"id"},dimensions:{},defaults:{colorscale:d3.scale.linear().domain([1,10,20]).range(["green","yellow","red"]).interpolate(d3.cie.interpolateLab),opacity:.75,order:[]}},crosslet.defaultDimensionConfig={p:{},filter:null,data:{interval:null,filter:null,field:function(a){return a.id},dataSet:crosslet.notimplemented,method:d3.tsv,preformat:function(a){return function(a){return+a}},ticks:4,colorscale:d3.scale.linear().domain([1,10,20]).range(["green","yellow","red"]).interpolate(d3.cie.interpolateLab),exponent:1},format:{"short":function(a){return d3.format(",.2f")},"long":function(a){return a.format.short(a)},input:function(a){return d3.format(".2f")},axis:function(a){return a.format.short(a)}},render:{legend:function(a,b){var c,d;return c=a.title?a.title:a.data.field_func(a),d="<h2>"+c+"</h2>",b.html(d)},range:function(a,b){var c;return c="<p><span class='m0'>"+a.format.short(a)(a.filter[0])+"</span> &ndash; <span class='m1'>"+a.format.short(a)(a.filter[1])+"</span></p>",b.html(c)},form:function(a,b){return a.render.legend(a,b)},rangeForm:function(a,b){var c,d;return d=_.max(_.map(a.data.interval,function(b){return("_"+a.format.input(a)(b)).length-1})),c="Range: <input type='text' name='m0' size='"+d+"' value='"+a.format.input(a)(a.filter[0])+"'> &ndash; <input type='text' name='m1' size='3' value='"+a.format.input(a)(a.filter[1])+"'>",b.html(c)}},submitter:function(a,b){var c;return c={},$(b).find("input, select").each(function(a,b){return c[$(b).attr("name")]=$(b).val()}),c}};var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__indexOf=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};crosslet.DataStore=function(){function a(a){this.loadGeo=__bind(this.loadGeo,this);var b,c;this.geoURL=a.map.geo.url,this.version=a.data.version,this.idField=(b=a.data.id_field)!=null?b:"id",this.geoIdField=(c=a.map.geo.id_field)!=null?c:"id",window.dataloader||(window.dataloader=new crosslet.DataLoader),this.l=window.dataloader}return a.prototype.data={},a.prototype.geometries=null,a.prototype.isGeoLoaded=!1,a.prototype.isDataLoaded=!1,a.prototype.addData=function(a,b){var c,d,e,f,g;for(f=0,g=a.length;f<g;f++){c=a[f],this.data[c[this.idField]]||(this.data[c[this.idField]]={});for(d in c)e=c[d],e!==""&&!_.isNaN(+e)&&(this.data[c[this.idField]][d]=+e)}this.isDataLoaded=!0;if(b)return b(a)},a.prototype.loadData=function(a,b,c){var d=this;return c||(c=d3.tsv),this.l.load(a,c,function(a){return d.addData(a,b)}),this},a.prototype.get_bounds_topo=function(a){var b,c,d,e,f,g,h,i,j,k;e=[],j=[_.min,_.max];for(f=0,h=j.length;f<h;f++){c=j[f],b=[],k=[0,1];for(g=0,i=k.length;g<i;g++)d=k[g],b.push(c(_.map(a,function(a){return c(_.map(a.coordinates[0],function(a){return a[d]}))})));e.push(b)}return e},a.prototype.loadGeo=function(a,b,c,d){var e=this;return this.l.load(a,d3.json,function(a){var b,f,g,h;a.arcs?(a=topojson.object(a,a.objects[d]),e.geometries=a.geometries):e.geometries=a.features,e.bounds=d3.geo.bounds(a),h=e.geometries;for(f=0,g=h.length;f<g;f++)b=h[f],b.properties&&(e.data[b.properties[e.geoIdField]]?e.data[b.properties[e.geoIdField]]=jQuery.extend(!0,e.data[b.properties[e.geoIdField]],b.properties):e.data[b.properties[e.geoIdField]]=b.properties,e.data[b.properties[e.geoIdField]].bbox=d3.geo.bounds(b));return e.isGeoLoaded=!0,c&&c(e),e})},a}(),crosslet.DataLoader=function(){function a(a){a||(a="1.0"),this.version=a,this.indexedDB=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB}return a.prototype.cache={},a.prototype.status={},a.prototype.callbackList={},a.prototype.load=function(a,b,c){var d,e=this;return d=a+this.version,this.callbackList[d]||(this.callbackList[d]=[]),this.status[d]||(this.status[d]="init"),c&&this.callbackList[d].push(c),__indexOf.call(this.cache,d)>=0?(this.executeCallbacks(this.callbackList[d],this.cache[d]),this):(this.status[d]!=="loading"&&(this.status[d]="loading",b(a,function(a){return e.cache[d]=a,e.executeCallbacks(e.callbackList[d],e.cache[d]),e.status[d]="done",e})),this)},a.prototype.executeCallbacks=function(a,b){var c;c=[];while(a.length>0)c.push(a.pop()(b));return c},a}();var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};crosslet.PanelView=function(a){function b(){this.renderCubes=__bind(this.renderCubes,this),this.createCube=__bind(this.createCube,this),this.setActive=__bind(this.setActive,this),this._renderMap=__bind(this._renderMap,this),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.initialize=function(a,b,c){var d,e,f,g,h;this.config=crosslet.createConfig(crosslet.defaultConfig,b),this.parent=c,this.el=a,this.ds=c.ds,this.boxes={},this.render(),this.width=200,this.active=this.config.defaults.active?this.config.defaults.active:this.config.defaults.order[0],this.numloads=this.config.defaults.order.length,h=this.config.defaults.order;for(f=0,g=h.length;f<g;f++)e=h[f],d=$("<div class='box'></div>"),this.boxes[e]=new crosslet.BoxView(d,this.config.dimensions[e],this,e),$(this.el).append(d);return this.boxes[this.active].setActive(!0),this.renderMap=_.debounce(this._renderMap,300),this.boxes},b.prototype.loaded=function(){this.numloads=this.numloads-1;if(this.numloads<=0)return this.createCube()},b.prototype._renderMap=function(){var a,b,c,d,e,f,g,h,i=this;a=this.boxes[this.active],b=a.getFilteredData(),e=this.intersection(_.map(_.values(this.boxes),function(a){return _.keys(a.getFilteredData()).sort()})),f={};for(g=0,h=e.length;g<h;g++)d=e[g],f[d]=b[d];return c=a.config.format.long(a.config),this.parent.renderMap(f,function(b){return a.config.data.colorscale(a.config.scale(b))},function(a,b){return a.properties[i.config.map.geo.name_field]+" - "+c(b)}),this},b.prototype.setActive=function(a){if(a!==this.active)return this.boxes[this.active].setActive(!1),this.active=a,this.boxes[this.active].setActive(!0),this.renderMap()},b.prototype.intersection=function(a){var b,c,d,e,f,g;b=function(a,b){var c,d,e;c=d=0,e=[];while(c<a.length&&d<b.length)a[c]<b[d]&&c++,a[c]>b[d]&&d++,a[c]===b[d]&&(e.push(a[c]),c++,d++);return e};switch(a.length){case 0:return a;case 1:return a[0];case 2:return b(a[0],a[1]);default:d=a[0],g=a.slice(1);for(e=0,f=g.length;e<f;e++)c=g[e],d=b(d,c);return d}},b.prototype.createCube=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z;this.rows=[],p=(new Date).getTime(),m=_.map(_.values(this.boxes),function(a){return _.keys(a.data).sort()}),q=(new Date).getTime(),i=this.intersection(m);for(t=0,v=i.length;t<v;t++){l=i[t],o={},x=this.boxes;for(a in x)b=x[a],o[a]=b.data[l];this.rows.push(o)}r=(new Date).getTime(),this.cube=crossfilter(this.rows),g=function(a,b,c,d){var e,f;return f=5*(b-a)/c,e=d3.scale.pow().exponent(d).range([a/f,b/f]).domain([a/f,b/f]),function(a){return f*e.invert(Math.floor(e(+a/f)))}},h={},this.charts={},c=function(a,b){return function(){return a.event_click(),b.renderCubes()}},y=this.boxes;for(a in y){b=y[a];var d,k,j;k=b,j=a,e=this.cube.dimension(function(b){return b[a]}),f=e.group(g(b.config.data.interval[0],b.config.data.interval[1],this.width-20,b.config.data.exponent)),b.graph.empty(),s=d3.scale.linear().clamp(!0).range([20,0]),d=barChart().dimension(e).name_id(a).group(f).x(d3.scale.pow().exponent(b.config.data.exponent).domain(b.config.data.interval).rangeRound([0,this.width-20])).y(s.copy()).ticks(b.config.data.ticks).tickFormat(b.config.format.axis(b.config)).fill(b.config.data.colorscale),d.on("brush",c(b,this)),d.on("brushend",this.renderCubes),b.chart=d,this.charts[a]=d}this.parent.ds.isGeoLoaded&&this.renderCubes(),z=this.config.defaults.order;for(u=0,w=z.length;u<w;u++)n=z[u],this.config.dimensions[n].filter&&this.boxes[n].setFilter(this.config.dimensions[n].filter,!0);return this},b.prototype.renderCubes=function(){var a,b,c,d;d=this.boxes;for(b in d)c=d[b],c.chart(c.graph),$(c.el).on("mousedown",c.event_click),c.setFilter(c.chart.filter(),!1);return a=this.boxes[this.active],a.setFilter(a.chart.filter(),!1),this.renderMap(),this},b}(Backbone.View),crosslet.BoxView=function(a){function b(){this.setFilter=__bind(this.setFilter,this),this.event_click=__bind(this.event_click,this),this.setActive=__bind(this.setActive,this),this.dataLoaded=__bind(this.dataLoaded,this),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.initialize=function(a,b,c,d){return this.el=a,this.config=crosslet.createConfig(crosslet.defaultDimensionConfig,b),this.config.id=d,this.config.data.field_func=_.isFunction(this.config.data.field)?this.config.data.field:function(a){return a.data.field},$(this.el).on("mousedown",this.event_click),$(this.el).on("tap",this.event_click),$(this.el)[0].onmousedown=$(this.el)[0].ondblclick=L.DomEvent.stopPropagation,this.legend={},this.legend.all=$("<div class='legend'></div>"),this.legend.text=$("<div class='legendText'></div>"),this.legend.text_p=$("<div class='legendText_p'></div>"),this.legend.text_range=$("<div class='legendText_range'></div>"),this.legend.text.append(this.legend.text_p).append(this.legend.text_range),this.legend.form=$("<div class='legendForm'></div>"),this.legend.form_p=$("<div class='legendForm_p'></div>"),this.legend.form_range=$("<div class='legendForm_range'></div>"),this.legend.form.append(this.legend.form_p).append(this.legend.form_range),this.legend.all.append(this.legend.text).append(this.legend.form),$(a).append(this.legend.all),this.graph=$("<div class='graph'></div>"),$(a).append(this.graph),this.parent=c,this.ds=c.ds,this.active=!1,this.name=d,this.loadData()},b.prototype.loadData=function(){return _.isString(this.config.data.dataSet)?this.parent.ds.loadData(this.config.data.dataSet,this.dataLoaded,this.config.data.method):_.isFunction(this.config.data.dataSet)?this.parent.ds.loadData(this.config.data.dataSet(this.config),this.dataLoaded,this.config.data.method):this.parent.ds.addData(this.config.data.dataSet,this.dataLoaded)},b.prototype.dataLoaded=function(){var a,b,c,d,e,f;this.data={},a=this.config.data.field_func(this.config),d=this.config.data.preformat(this.config),f=this.parent.ds.data;for(b in f)e=f[b],_.isNumber(e[a])&&(c=d(e[a])),_.isNumber(c)&&(this.data[b]=c);return this.config.data.interval||(this.config.data.interval=[_.min(_.values(this.data)),_.max(_.values(this.data))]),this.config.filter||(this.config.filter=[_.min(_.values(this.data)),_.max(_.values(this.data))]),this.config.scale=d3.scale.pow().exponent(this.config.data.exponent).domain(this.config.data.interval).rangeRound([0,20]),this.config.scale.name="yes",this.render(),this.parent.loaded()},b.prototype.setActive=function(a){return this.active=a,a?$(this.el).addClass("selected"):$(this.el).removeClass("selected")},b.prototype.event_click=function(a){return this.active||this.parent.setActive(this.name),!0},b.prototype.setFilter=function(a,b){return b==null&&(b=!1),b&&(this.chart.filter(a),this.parent.renderCubes()),a||(a=this.config.data.interval),this.config.filter=a,this.filterElements[0].val(this.config.format.input(this.config)(a[0])),this.filterElements[1].val(this.config.format.input(this.config)(a[1])),$(this.legend.text_range).find(".m0").text(this.config.format.short(this.config)(a[0])),$(this.legend.text_range).find(".m1").text(this.config.format.short(this.config)(a[1])),this},b.prototype.getFilteredData=function(){var a,b,c,d,e,f;if(!this.chart.filter())return this.data;a=(e=this.chart.filter())!=null?e:this.config.data.interval,c={},f=this.data;for(b in f)d=f[b],a[0]<=d&&d<=a[1]&&(c[b]=d);return c},b.prototype.renderRange=function(){return this.config.render.range(this.config,this.legend.text_range),this.config.render.rangeForm(this.config,this.legend.form_range)},b.prototype.render=function(){var a=this;return this.config.render.legend(this.config,this.legend.text_p),this.config.render.form(this.config,this.legend.form_p),this.renderRange(),$(this.legend.form_range).find("input").on("change",function(){var b;return b=[+a.filterElements[0].val(),+a.filterElements[1].val()],b[0]>b[1]&&b.reverse(),b[0]=_.max([a.config.data.interval[0],b[0]]),b[1]=_.min([a.config.data.interval[1],b[1]]),_.isEqual(b,a.config.data.interval)&&(b=null),a.setFilter(b,!0)}),$(this.legend.form_p).find("input, select").on("change",function(){var b;return a.config.data.interval=null,a.config.scale=null,a.config.filter=null,b=a.config.submitter(a.config,a.legend.form_p),a.config.p=b,console.log(b),a.loadData()}),this.filterElements=[$(this.legend.form_range).find("input[name=m0]"),$(this.legend.form_range).find("input[name=m1]")]},b}(Backbone.View);var __bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp=Object.prototype.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};crosslet.MapView=function(a){function b(){this._renderMap=__bind(this._renderMap,this),this.hover=__bind(this.hover,this),this.mouseMove=__bind(this.mouseMove,this),this.reset=__bind(this.reset,this),this.beforezoom=__bind(this.beforezoom,this),this.project=__bind(this.project,this),b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.initialize=function(a,b){var c=this;return this.config=crosslet.createConfig(crosslet.defaultConfig,b),this.geoURL=this.config.map.geo.url,this.opacity=this.config.defaults.opacity,this.ds=new crosslet.DataStore(this.config),this.el=a,this.hoverFunc=this.default_hover,$(this.el).attr("class","crosslet"),this.map=L.map(a[0]).setView(this.config.map.view.center,this.config.map.view.zoom),L.tileLayer("http://{s}.tile.cloudmade.com/{key}/{styleId}/256/{z}/{x}/{y}.png",this.config.map.leaflet).addTo(this.map),this.control=$("<div class='crosslet_panel'></div>"),this.info=L.Control.extend({options:{position:"topright"},onAdd:function(a){return c.control[0]}}),this.map.addControl(new this.info),this.panel=new crosslet.PanelView(this.control,this.config,this),this.renderMap=this._renderMap,this.ds.loadGeo(this.geoURL,this.config.map.geo.id_field,function(a){c.bounds=c.ds.bounds,c.path=d3.geo.path().projection(c.project),c.svg=d3.select(c.map.getPanes().overlayPane).append("svg"),c.g=c.svg.append("g"),c.g.attr("class","crosslet_geometry"),c.feature=c.g.selectAll("path").data(a.geometries).enter().append("path").attr("id",function(a){return"path_"+a.properties[c.config.map.geo.id_field]}).on("mouseover",function(a){return c.hover(a)}).on("mousemove",c.mouseMove),c.reset(),c.map.on("viewreset",c.reset),c.map.on("zoomstart",c.beforezoom),c.hoverElement=c.svg.append("g").attr("class","hover"),c.hoverElementRect=c.hoverElement.append("svg:rect").attr("x",0).attr("y",0).attr("width",10).attr("height",30).attr("rx",5).attr("ry",5),c.hoverElementText=c.hoverElement.append("text").attr("x",0).attr("y",0),c.hoverElementTextBB={width:0,height:0,x:0,y:0};if(c.panel.numloads<=0)return c.panel.createCube()},this.config.map.geo.topo_object)},b.prototype.project=function(a){var b;return b=this.map.latLngToLayerPoint(new L.LatLng(a[1],a[0])),[b.x,b.y]},b.prototype.beforezoom=function(){return this.g.style("display","none")},b.prototype.reset=function(){var a,b;return a=this.project(this.bounds[0]),b=this.project(this.bounds[1]),this.svg.attr("width",b[0]-a[0]).attr("height",a[1]-b[1]).style("margin-left",a[0]+"px").style("margin-top",b[1]+"px"),this.g.attr("transform","translate("+ -a[0]+","+ -b[1]+")"),this.feature.attr("d",this.path),this.g.style("display","inline"),!0},b.prototype.mouseMove=function(){var a,b,c,d,e,f;return a=jQuery.browser,e=d3.mouse(this.svg.node()),a.mozilla&&(f=this.svg.node().parentNode.parentNode.parentNode,d=$(f).css("transform").split("(")[1].split(")")[0].split(","),b=+d[4],c=+d[5],e[0]-=b,e[1]-=c),e[0]+=30,e[1]+=30,this.hoverElementTextBB.width+e[0]>=this.svg.attr("width")&&(e[0]-=this.hoverElementTextBB.width+60),this.hoverElementTextBB.height+e[1]>=this.svg.attr("height")&&(e[1]-=this.hoverElementTextBB.height+60),this.hoverElement.attr("transform","translate("+e[0]+","+e[1]+")")},b.prototype.hover=function(a){var b;return b=this.hoverFunc(a,a.properties.value),this.hoverElementText.text(b),this.hoverElementTextBB=this.hoverElementText.node().getBBox(),this.hoverElementRect.attr("width",this.hoverElementTextBB.width+10).attr("height",this.hoverElementTextBB.height+10).attr("x",this.hoverElementTextBB.x-5).attr("y",this.hoverElementTextBB.y-5)},b.prototype.default_hover=function(a,b){return a.properties[this.config.map.geo.name_field]+" - "+b},b.prototype._renderMap=function(a,b,c){var d=this;return c&&(this.hoverFunc=c),this.feature.attr("style",function(c){var e;return e=c.properties[d.config.map.geo.id_field],c.properties.value=a[e],_.isNumber(a[e])?"fill: "+b(c.properties.value):"display:none"}),this},b}(Backbone.View);